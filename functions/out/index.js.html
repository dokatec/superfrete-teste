<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const functions = require("firebase-functions/v1");
const admin = require("firebase-admin");

admin.initializeApp();
const db = admin.firestore();

/** This is a description of the foo function. */
exports.addName = functions.https.onRequest(async (req, res) => {
  const {name} = req.body;
  const writeResult = await admin
      .firestore()
      .collection("messages")
      .add({name});
  res.json({result: `Message with ID: ${writeResult.id} added.`});
});

/** This is a description of the foo function. */
exports.getNames = functions.https.onRequest(async (req, res) => {
  db.collection("messages")
      .get()
      .then((docs) => {
        const todos = [];
        docs.forEach((doc) => {
        // eslint-disable-next-line max-len
          todos.push({
            increment_Id: doc.data().increment_id,
            messages: doc.data().name,
          });
        });
        res.json(todos);
      });
});

/** This is a description of the foo function. */
exports.incrementDocumentID = functions.firestore
    .document("/messages/{docId}")
    .onCreate(async (snap, context) => {
      const name = db.collection("counters").doc("increment_id");
      try {
        await admin.firestore().runTransaction(async (transaction) => {
          const doc = await transaction.get(name);
          const newId = (doc.exists ? doc.data().value : 0) + 1;
          transaction.set(name, {value: newId});
          transaction.update(snap.ref, {increment_id: newId});
        });
      } catch (error) {
        console.error("Erro ao gerar increment_id:", error);
      }
    });
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addName">addName</a></li><li><a href="global.html#getNames">getNames</a></li><li><a href="global.html#incrementDocumentID">incrementDocumentID</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Sun Sep 29 2024 01:49:42 GMT-0300 (Horário Padrão de Brasília)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
